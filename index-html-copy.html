<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY - Writing Models</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0d0d0d;
      background-image: radial-gradient(circle at 20% 50%, rgba(201, 169, 97, 0.04) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(201, 169, 97, 0.03) 0%, transparent 50%);
      color: #e5e5e7;
      min-height: 100vh;
      position: relative;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.01'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 1;
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 75rem;
      margin: 0 auto;
      padding: 0.5rem;
    }

    /* HEADER */
    .global-header {
      background: rgba(28, 28, 30, 0.95);
      backdrop-filter: blur(40px) saturate(180%);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
      padding: 0.75rem 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .header-row-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .brand {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }
    
    .brand-logo {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(135deg, #C9A961 0%, rgba(255,255,255,0.85) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: -0.04em;
    }
    
    .brand-subtitle {
      font-size: 0.7rem;
      color: #C9A961;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* More Button - Contextual Discovery */
    .more-btn {
      background: rgba(201, 169, 97, 0.15);
      border: 1px solid rgba(201, 169, 97, 0.3);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #C9A961;
      font-size: 1.25rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      pointer-events: none;
      position: relative;
    }

    .global-header:hover .more-btn {
      opacity: 1;
      pointer-events: auto;
    }

    .more-btn:hover {
      background: rgba(201, 169, 97, 0.25);
      border-color: rgba(201, 169, 97, 0.5);
      transform: scale(1.1);
    }

    .more-btn:active {
      transform: scale(0.95);
    }

    /* Slide-out Mini Menu */
    .more-menu {
      position: absolute;
      top: calc(100% + 0.5rem);
      right: 0;
      background: rgba(28, 28, 30, 0.98);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(201, 169, 97, 0.3);
      border-radius: 0.875rem;
      padding: 0.5rem;
      min-width: 200px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 100;
    }

    .more-menu.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .more-menu-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      color: #e5e5e7;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      font-family: 'Space Grotesk', sans-serif;
    }

    .more-menu-item:hover {
      background: rgba(201, 169, 97, 0.15);
      color: #C9A961;
      transform: translateX(4px);
    }

    .more-menu-item:active {
      transform: translateX(2px) scale(0.98);
    }

    .more-menu-icon {
      font-size: 1.25rem;
      line-height: 1;
    }

    .more-menu-label {
      flex: 1;
    }

    /* Arrow indicator */
    .more-menu::before {
      content: '';
      position: absolute;
      top: -6px;
      right: 12px;
      width: 12px;
      height: 12px;
      background: rgba(28, 28, 30, 0.98);
      border-left: 1px solid rgba(201, 169, 97, 0.3);
      border-top: 1px solid rgba(201, 169, 97, 0.3);
      transform: rotate(45deg);
    }

    /* ESSAY CONTAINER - Warm Paper Feel */
    .essay-container {
      background: linear-gradient(135deg, #f5f1e8 0%, #ede8dc 100%);
      padding: 3.5rem 3rem 2rem;
      border-radius: 2rem;
      max-width: 52rem;
      margin: 0 auto 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4),
                  0 0 1px rgba(0, 0, 0, 0.1) inset;
      position: relative;
    }

    /* DEFAULT POSTER MESSAGE */
    .poster-message {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      text-align: center;
      padding: 3rem 2rem;
    }

    .poster-text {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      line-height: 1.2;
      background: linear-gradient(135deg, #C9A961 0%, #8B7355 50%, #C9A961 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: -0.02em;
      text-shadow: 0 4px 12px rgba(201, 169, 97, 0.2);
      animation: fadeInScale 1s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Essay Title */
    .essay-title {
      font-family: 'Crimson Text', Georgia, serif;
      font-size: 2rem;
      font-weight: 700;
      color: #1a1a1a;
      text-align: center;
      margin-bottom: 2.5rem;
      line-height: 1.3;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }

    /* Paragraph Section */
    .paragraph-section {
      position: relative;
      padding: 1.75rem 0.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-bottom: 1px dotted rgba(0, 0, 0, 0.08);
      cursor: default;
    }

    .paragraph-section:last-child {
      border-bottom: none;
    }

    .paragraph-section:hover {
      background: rgba(201, 169, 97, 0.06);
      border-radius: 0.75rem;
      padding: 1.75rem 1.5rem;
      box-shadow: 0 2px 8px rgba(201, 169, 97, 0.15);
    }

    /* Section Heading */
    .section-heading {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #6b5843;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid rgba(201, 169, 97, 0.3);
    }

    /* Paragraph Text */
    .paragraph-text {
      font-family: 'Crimson Text', Georgia, serif;
      font-size: 1.1875rem;
      line-height: 1.85;
      color: #2a2a2a;
      text-align: justify;
      text-indent: 2.5rem;
      margin: 0;
    }

    /* Discourse Marker Highlighting */
    .discourse-marker {
      background: rgba(100, 149, 237, 0.2);
      padding: 0.15rem 0.4rem;
      border-radius: 0.25rem;
      font-weight: 600;
    }

    /* Navigation Controls - Hidden by Default */
    .paragraph-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .paragraph-section:hover .paragraph-nav {
      opacity: 1;
      pointer-events: auto;
    }

    .paragraph-nav.nav-left {
      left: -3.5rem;
    }

    .paragraph-nav.nav-right {
      right: -3.5rem;
    }

    /* Navigation Buttons */
    .nav-btn {
      width: 36px;
      height: 36px;
      background: rgba(201, 169, 97, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(201, 169, 97, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #C9A961;
      font-size: 1.125rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .nav-btn:hover {
      background: rgba(201, 169, 97, 0.25);
      border-color: rgba(201, 169, 97, 0.5);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }

    .nav-btn:active {
      transform: scale(0.95);
    }

    .nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      transform: scale(1);
    }

    /* Sample Counter */
    .sample-counter {
      position: absolute;
      bottom: 0.5rem;
      right: 1rem;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.6875rem;
      font-weight: 600;
      color: rgba(0, 0, 0, 0.35);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      letter-spacing: 0.05em;
    }

    .paragraph-section:hover .sample-counter {
      opacity: 1;
    }

    /* NAVIGATION PILLS - At Bottom of Container */
    .nav-pills {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem 1rem;
      flex-wrap: wrap;
    }

    .pill-btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.75rem 2rem;
      border: 2px solid transparent;
      border-radius: 2rem;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
      animation: float 3s ease-in-out infinite;
      /* Unified greyish-gold gradient for all pills */
      background: linear-gradient(135deg, #9a9186 0%, #c9a961 100%);
      color: #2a2420;
      box-shadow: 0 4px 15px rgba(154, 145, 134, 0.25);
    }

    .pill-btn:nth-child(1) {
      animation-delay: 0s;
    }

    .pill-btn:nth-child(2) {
      animation-delay: 0.2s;
    }

    .pill-btn:nth-child(3) {
      animation-delay: 0.4s;
    }

    .pill-btn:nth-child(4) {
      animation-delay: 0.6s;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-8px);
      }
    }

    .pill-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .pill-btn:hover::before {
      left: 100%;
    }

    .pill-btn:hover {
      transform: translateY(-6px) scale(1.08);
      animation: none;
      filter: brightness(1.1);
      box-shadow: 0 8px 25px rgba(201, 169, 97, 0.4);
    }

    .pill-btn:active {
      transform: translateY(-2px) scale(1.02);
    }

    .pill-btn.active {
      border: 2px solid rgba(201, 169, 97, 0.6);
      font-weight: 800;
      filter: brightness(1.15);
      box-shadow: 0 6px 20px rgba(201, 169, 97, 0.5),
                  0 0 25px rgba(201, 169, 97, 0.2) inset;
    }

    /* Loading State */
    .loading-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #8e8e93;
    }

    .loading-spinner {
      display: inline-block;
      width: 2.5rem;
      height: 2.5rem;
      border: 3px solid rgba(201, 169, 97, 0.2);
      border-top-color: #C9A961;
      border-radius: 50%;
      animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      .essay-container {
        padding: 2rem 1.5rem 1.5rem;
        border-radius: 1.5rem;
      }

      .poster-text {
        font-size: 2rem;
      }

      .essay-title {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .paragraph-text {
        font-size: 1.0625rem;
        text-indent: 1.5rem;
      }

      .paragraph-section:hover {
        padding: 1.75rem 1rem;
      }

      /* Show nav buttons below paragraph on mobile */
      .paragraph-nav.nav-left {
        left: 1rem;
        top: auto;
        bottom: 0.5rem;
        transform: none;
      }

      .paragraph-nav.nav-right {
        right: 1rem;
        top: auto;
        bottom: 0.5rem;
        transform: none;
      }

      .paragraph-section:hover .paragraph-nav {
        opacity: 1;
      }

      .nav-pills {
        gap: 0.5rem;
        padding: 1rem 0.5rem;
      }

      .pill-btn {
        font-size: 0.75rem;
        padding: 0.65rem 1.5rem;
      }
    }

    /* Tablet */
    @media (max-width: 1024px) and (min-width: 769px) {
      .paragraph-nav.nav-left {
        left: -2.5rem;
      }

      .paragraph-nav.nav-right {
        right: -2.5rem;
      }

      .poster-text {
        font-size: 2.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- HEADER -->
    <header class="global-header">
      <div class="header-row-main">
        <div class="brand">
          <span class="brand-logo">INTUITY</span>
          <span class="brand-subtitle" id="brandSubtitle">Writing Models</span>
        </div>
        
        <!-- More Button with Slide-out Menu -->
        <div style="position: relative;">
          <button class="more-btn" id="moreBtn" onclick="toggleMoreMenu(event)">‚ãØ</button>
          
          <div class="more-menu" id="moreMenu">
            <a href="#" class="more-menu-item" onclick="handleMenuAction('questions')">
              <span class="more-menu-icon">üìã</span>
              <span class="more-menu-label">Browse Questions</span>
            </a>
            <a href="#" class="more-menu-item" onclick="handleMenuAction('plans')">
              <span class="more-menu-icon">üí°</span>
              <span class="more-menu-label">View Plans</span>
            </a>
            <a href="#" class="more-menu-item" onclick="handleMenuAction('structures')">
              <span class="more-menu-icon">üèóÔ∏è</span>
              <span class="more-menu-label">Study Structures</span>
            </a>
            <a href="#" class="more-menu-item" onclick="handleMenuAction('practice')">
              <span class="more-menu-icon">‚úçÔ∏è</span>
              <span class="more-menu-label">Practice Writing</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- ESSAY CONTAINER -->
    <div class="essay-container" id="essayContainer">
      <div class="poster-message">
        <div class="poster-text">Try not to fail<br>but practise to<br>succeed</div>
      </div>

      <!-- NAVIGATION PILLS -->
      <div class="nav-pills">
        <button class="pill-btn" data-type="essays" onclick="loadWritingType('essays')">Essays</button>
        <button class="pill-btn" data-type="reports" onclick="loadWritingType('reports')">Reports</button>
        <button class="pill-btn" data-type="reviews" onclick="loadWritingType('reviews')">Reviews</button>
        <button class="pill-btn" data-type="emails" onclick="loadWritingType('emails')">Emails</button>
      </div>
    </div>

  </div>

  <script>
    // State management
    let currentType = null;
    let currentData = null;
    let paragraphIndices = []; // Track which sample is shown for each paragraph

    // Data paths
    const DATA_PATHS = {
      essays: 'data/essays-models.json',
      reports: 'data/reports-models.json',
      reviews: 'data/reviews-models.json',
      emails: 'data/emails-models.json'
    };

    // Load writing type
    async function loadWritingType(type) {
      console.log(`üìö Loading ${type}...`);
      currentType = type;

      // Update active button
      document.querySelectorAll('.pill-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.type === type) {
          btn.classList.add('active');
        }
      });

      // Update subtitle
      document.getElementById('brandSubtitle').textContent = 
        type.charAt(0).toUpperCase() + type.slice(1);

      // Show loading
      const container = document.getElementById('essayContainer');
      container.innerHTML = `
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <div style="font-weight: 600;">Loading ${type}...</div>
        </div>
      `;

      try {
        const response = await fetch(DATA_PATHS[type]);
        if (!response.ok) {
          throw new Error(`Failed to load ${type}: ${response.status}`);
        }

        const data = await response.json();
        console.log(`‚úÖ Loaded ${type} data:`, data);

        currentData = data;
        
        // Initialize paragraph indices (all start at 0)
        if (data.samples && data.samples.length > 0) {
          const numParagraphs = data.samples[0].paragraphs.length;
          paragraphIndices = new Array(numParagraphs).fill(0);
          renderWriting();
        } else {
          throw new Error('No samples found in data');
        }

      } catch (error) {
        console.error(`‚ùå Error loading ${type}:`, error);
        container.innerHTML = `
          <div class="loading-state" style="color: #ef4444;">
            <div style="font-size: 2rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
            <div style="font-weight: 600;">Failed to load ${type}</div>
            <div style="font-size: 0.875rem; margin-top: 0.5rem;">
              Please check that ${DATA_PATHS[type]} exists
            </div>
          </div>
          <div class="nav-pills">
            <button class="pill-btn" data-type="essays" onclick="loadWritingType('essays')">Essays</button>
            <button class="pill-btn" data-type="reports" onclick="loadWritingType('reports')">Reports</button>
            <button class="pill-btn" data-type="reviews" onclick="loadWritingType('reviews')">Reviews</button>
            <button class="pill-btn" data-type="emails" onclick="loadWritingType('emails')">Emails</button>
          </div>
        `;
      }
    }

    // Render the writing
    function renderWriting() {
      const container = document.getElementById('essayContainer');
      
      if (!currentData || !currentData.samples || currentData.samples.length === 0) {
        container.innerHTML = '<div class="loading-state">No data available</div>';
        return;
      }

      const firstSample = currentData.samples[0];
      
      let html = '';
      
      // Add title if available
      if (currentData.title) {
        html += `<div class="essay-title">${currentData.title}</div>`;
      }

      // Render each paragraph with independent navigation
      firstSample.paragraphs.forEach((para, paraIndex) => {
        const currentSampleIndex = paragraphIndices[paraIndex];
        const currentPara = currentData.samples[currentSampleIndex].paragraphs[paraIndex];
        const totalSamples = currentData.samples.length;

        // Highlight discourse markers
        const highlightedText = highlightDiscourseMarkers(currentPara.text);

        html += `
          <div class="paragraph-section" data-para-index="${paraIndex}">
            
            ${currentPara.label ? `<div class="section-heading">${currentPara.label}</div>` : ''}

            <!-- Left Navigation -->
            <div class="paragraph-nav nav-left">
              <button class="nav-btn" 
                      onclick="navigateParagraph(${paraIndex}, -1)"
                      ${currentSampleIndex === 0 ? 'disabled' : ''}>
                ‚Üê
              </button>
            </div>

            <!-- Paragraph Text -->
            <p class="paragraph-text">${highlightedText}</p>

            <!-- Right Navigation -->
            <div class="paragraph-nav nav-right">
              <button class="nav-btn" 
                      onclick="navigateParagraph(${paraIndex}, 1)"
                      ${currentSampleIndex === totalSamples - 1 ? 'disabled' : ''}>
                ‚Üí
              </button>
            </div>

            <!-- Sample Counter -->
            <div class="sample-counter">${currentSampleIndex + 1}/${totalSamples}</div>

          </div>
        `;
      });

      // Add navigation pills at bottom
      html += `
        <div class="nav-pills">
          <button class="pill-btn ${currentType === 'essays' ? 'active' : ''}" data-type="essays" onclick="loadWritingType('essays')">Essays</button>
          <button class="pill-btn ${currentType === 'reports' ? 'active' : ''}" data-type="reports" onclick="loadWritingType('reports')">Reports</button>
          <button class="pill-btn ${currentType === 'reviews' ? 'active' : ''}" data-type="reviews" onclick="loadWritingType('reviews')">Reviews</button>
          <button class="pill-btn ${currentType === 'emails' ? 'active' : ''}" data-type="emails" onclick="loadWritingType('emails')">Emails</button>
        </div>
      `;

      container.innerHTML = html;
    }

    // Highlight discourse markers in text
    function highlightDiscourseMarkers(text) {
      const markers = [
        // Contrast/Opposition
        'However', 'Nevertheless', 'On the other hand', 'Conversely', 'Despite these positives',
        'That said', 'Although', 'Though', 'While', 'Whereas', 'By far the worst',
        // Addition/Emphasis
        'Moreover', 'Furthermore', 'In addition', 'Additionally', 'Also', 'As well as',
        'In particular', 'Especially', 'Similarly', 'Likewise',
        // Result/Consequence
        'Therefore', 'Thus', 'Consequently', 'As a result', 'Hence',
        // Example/Illustration
        'For instance', 'For example', 'Such as',
        // Summary/Conclusion
        'In conclusion', 'To sum up', 'In summary', 'Overall', 'On balance',
        'All things considered', 'Taking everything into account', 'To conclude',
        'It can be concluded that', 'It seems clear that',
        // Purpose/Reason
        'In order to', 'So that', 'With regard to', 'Concerning', 'Regarding',
        // Sequence
        'Firstly', 'Secondly', 'Finally', 'Subsequently', 'Then',
        // Condition
        'If', 'Unless', 'Provided that', 'As long as', 'If we were to',
        // Recommendation phrases
        'I would recommend', 'I would suggest', 'I would strongly recommend',
        'I would strongly advise', 'It would be advisable', 'It is essential that',
        'one key recommendation would be', 'To enhance', 'To address', 'To reduce',
        'To improve', 'I would advise',
        // Opinion phrases
        'In my view', 'In my opinion',
        // Generalizations
        'Generally', 'In general', 'By and large',
        'There is a broad consensus', 'It is generally agreed', 'The majority of',
        'There is widespread agreement',
        // Report-specific intro phrases
        'The main objective of this report', 'The purpose of this report',
        'This report aims to', 'This report seeks to', 'The aim of this report',
        'This report is an evaluation of',
        // Data source phrases
        'The information presented in this report', 'The findings in this report',
        'Data was gathered through', 'Data was obtained through', 'Evidence was gathered through',
        'Information was obtained through',
        // Agreement/consensus phrases
        'most participants felt', 'most respondents', 'many visitors referred to',
        'many respondents', 'Students generally appreciated', 'Passengers generally praised',
        'The project has been received', 'Students expressed satisfaction',
        'were particularly commended', 'was particularly beneficial',
        // Criticism/complaint phrases
        'the most significant complaint', 'the main criticism', 'the main issue raised',
        'were identified as inadequate', 'were considered too high', 'has limited productivity',
        'emerged as the most serious concern', 'was seen as too restrictive',
        // Best/worst expressions
        'the best part of', 'The highlight of', 'proved to be extremely popular',
        'received excellent feedback', 'was widely regarded as',
        // Frequency adverbs
        'often feel', 'frequently mentioned', 'widely regarded', 'enthusiastically',
        // Passive constructions (key for formal writing)
        'was collected through', 'are drawn from', 'was gathered through',
        'were highlighted as', 'has been well-received', 'have been successful',
        'have been well-received', 'were especially appreciated',
        // Conditionals for recommendations
        'would be', 'would greatly benefit', 'would resolve', 'would ensure',
        'would make it more', 'would better serve', 'would be more suitable',
        'would maximize', 'would significantly improve',
        // Quantifiers
        'a wide range of', 'a broad consensus', 'approximately', 'several',
        // Time expressions
        'during peak hours', 'over a two-week period', 'six months ago',
        'over one month', 'During lunch breaks',
        // Evaluation language
        'given that', 'considering that', 'as customers often feel',
        // Conclusion starters
        'it can be concluded', 'it seems clear', 'Taking everything into account'
      ];

      let highlightedText = text;

      // Sort by length (longest first) to avoid partial matches
      markers.sort((a, b) => b.length - a.length);

      markers.forEach(marker => {
        // Create regex that matches the marker (case-insensitive, with word boundaries)
        const regex = new RegExp(`\\b(${marker.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})\\b`, 'gi');
        
        // Only replace if not already wrapped in a span
        highlightedText = highlightedText.replace(regex, (match) => {
          // Check if already inside a span tag
          if (!highlightedText.includes(`<span class="discourse-marker">${match}</span>`)) {
            return `<span class="discourse-marker">${match}</span>`;
          }
          return match;
        });
      });

      return highlightedText;
    }

    // Navigate to different sample for a specific paragraph
    function navigateParagraph(paraIndex, direction) {
      const totalSamples = currentData.samples.length;
      const newIndex = paragraphIndices[paraIndex] + direction;

      // Validate bounds
      if (newIndex < 0 || newIndex >= totalSamples) {
        return;
      }

      // Update the index for this paragraph
      paragraphIndices[paraIndex] = newIndex;

      // Re-render
      renderWriting();
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!currentData) return;

      // Find the currently focused paragraph (if any)
      const hoveredSection = document.querySelector('.paragraph-section:hover');
      if (hoveredSection) {
        const paraIndex = parseInt(hoveredSection.dataset.paraIndex);
        
        if (e.key === 'ArrowLeft') {
          e.preventDefault();
          navigateParagraph(paraIndex, -1);
        } else if (e.key === 'ArrowRight') {
          e.preventDefault();
          navigateParagraph(paraIndex, 1);
        }
      }
      
      // Close menu on Escape
      if (e.key === 'Escape') {
        const menu = document.getElementById('moreMenu');
        if (menu && menu.classList.contains('active')) {
          menu.classList.remove('active');
        }
      }
    });

    // More Menu Functions
    function toggleMoreMenu(event) {
      event.stopPropagation();
      const menu = document.getElementById('moreMenu');
      menu.classList.toggle('active');
    }

    function handleMenuAction(action) {
      event.preventDefault();
      
      // Close menu
      const menu = document.getElementById('moreMenu');
      menu.classList.remove('active');
      
      // Handle different actions based on current writing type
      const writingType = currentType || 'essays'; // Default to essays if none selected
      
      // Define paths for each writing type
      const paths = {
        essays: {
          questions: '../skills/writing/essays/essay-question-selector.html',
          plans: '../skills/writing/essays/essay-plans.html',
          structures: '../skills/writing/essays/essay-structures.html',
          practice: '../skills/writing/essays/essay-writer.html'
        },
        reports: {
          questions: '../skills/writing/reports/report-question-selector.html',
          plans: '../skills/writing/reports/report-plans.html',
          structures: '../skills/writing/reports/report-structure-practice.html',
          practice: '../skills/writing/reports/report-writer.html'
        },
        reviews: {
          questions: '../skills/writing/reviews/review-question-selector.html',
          plans: '../skills/writing/reviews/review-plans.html',
          structures: '../skills/writing/reviews/review-structures.html',
          practice: '../skills/writing/reviews/review-writer.html'
        },
        emails: {
          questions: '../skills/writing/emails/email-question-selector.html',
          plans: '../skills/writing/emails/email-plans.html',
          structures: '../skills/writing/emails/email-structures.html',
          practice: '../skills/writing/emails/email-writer.html'
        }
      };
      
      // Get the appropriate path
      const path = paths[writingType]?.[action];
      
      if (path) {
        // Navigate to the page
        window.location.href = path;
      } else {
        // Fallback - show alert
        const labels = {
          questions: 'Browse Questions',
          plans: 'View Plans',
          structures: 'Study Structures',
          practice: 'Practice Writing'
        };
        
        alert(`üöÄ ${labels[action]}\n\nThis will take you to ${writingType} ${action} page.\n(Path: ${writingType}/${action})`);
      }
    }

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      const menu = document.getElementById('moreMenu');
      const moreBtn = document.getElementById('moreBtn');
      
      if (menu && menu.classList.contains('active')) {
        if (!menu.contains(e.target) && !moreBtn.contains(e.target)) {
          menu.classList.remove('active');
        }
      }
    });
  </script>
</body>
</html>
